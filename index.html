<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë§ˆë‹ˆë˜ğŸ</title>
<style>
body { font-family: sans-serif; background:#fff0f5; padding:20px }
.card { background:white; padding:20px; border-radius:12px; max-width:420px; margin:auto }
input, button { width:100%; padding:10px; margin-top:8px }
button { background:#ff6b81; color:white; border:none; border-radius:8px }
.result { margin-top:15px; background:#fff5f5; padding:10px }
.admin { background:#636e72 }

.section { display:none }
</style>
</head>
<body>

<div class="card">
<h2>ğŸ ë§ˆë‹ˆë˜</h2>

<!-- GAME KEY -->
<div id="keySection">
  <input id="gameKey" placeholder="ì•”í˜¸ë¥¼ ëŒ€ì‹œì˜¤">
  <button onclick="enterGame()">ì…ì¥</button>
</div>

<!-- REGISTER -->
<div id="registerSection" class="section">
  <h3>ì°¸ê°€ ë“±ë¡</h3>
  <input id="r-name" placeholder="ì´ë¦„">
  <input id="r-pw" placeholder="ë¹„ë°€ë²ˆí˜¸">

  <hr>
  <h3>5ë§Œì› ì´í•˜ì˜ ì„ ë¬¼ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</h3>
  <input id="g1" placeholder="ì„ ë¬¼1 ì´ë¦„">
  <input id="g1l" placeholder="ì„ ë¬¼1 ë§í¬">
  <input id="g2" placeholder="ì„ ë¬¼2 ì´ë¦„">
  <input id="g2l" placeholder="ì„ ë¬¼2 ë§í¬">
  <input id="g3" placeholder="ì„ ë¬¼3 ì´ë¦„">
  <input id="g3l" placeholder="ì„ ë¬¼3 ë§í¬">

  <button onclick="register()">ë“±ë¡</button>
</div>

<!-- LOGIN -->
<div id="loginSection" class="section">
  <h3>ë¡œê·¸ì¸</h3>
  <input id="l-name" placeholder="ì´ë¦„">
  <input id="l-pw" placeholder="ë¹„ë°€ë²ˆí˜¸">
  <button onclick="login()">ì¡°íšŒ</button>
</div>

<div id="result" class="result"></div>

<hr>

<!-- ADMIN -->
<div id="adminSection" class="section">
  <h3>ê´€ë¦¬ì</h3>
  <input id="adminPw" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸">
  <button class="admin" onclick="match()">ë§¤ì¹­</button>
  <button class="admin" onclick="resetAll()">ë¦¬ì…‹</button>
</div>
</div>

<script>
const GAS_URL = "ë„ˆì˜_GAS_URL";

/* ê³µí†µ POST */
function post(data) {
  return fetch(GAS_URL, {
    method: "POST",
    body: JSON.stringify(data)
  }).then(r => r.json());
}

/* ===== UI ì œì–´ ===== */
function show(id) {
  document.getElementById(id).style.display = "block";
}
function hide(id) {
  document.getElementById(id).style.display = "none";
}

/* ===== STEP 1 ===== */
function enterGame() {
  const key = document.getElementById("gameKey").value;
  if (!key) return alert("ì•”í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”");

  hide("keySection");
  show("registerSection");
  show("adminSection");
}

/* ===== STEP 2 ===== */
function register() {
  const gifts = [
    { n: g1.value, l: g1l.value },
    { n: g2.value, l: g2l.value },
    { n: g3.value, l: g3l.value }
  ].filter(g => g.n);

  post({
    action: "register",
    gameKey: gameKey.value,
    name: document.getElementById("r-name").value,
    pw: document.getElementById("r-pw").value,
    gifts
  }).then(res => {
    if (res.error) return alert(res.error);

    alert("ë“±ë¡ ì™„ë£Œ!");
    hide("registerSection");
    show("loginSection");
  });
}

/* ===== STEP 3 ===== */
function login() {
  post({
    action: "login",
    gameKey: gameKey.value,
    name: document.getElementById("l-name").value,
    pw: document.getElementById("l-pw").value
  }).then(res => {
    if (res.error) return alert(res.error);

    let html = "<b>ë‚´ ì„ ë¬¼</b><br>";
    res.me.gifts.forEach(g =>
      html += `- <a href="${g.l}" target="_blank">${g.n}</a><br>`
    );

    if (res.me.target) {
      html += `<hr><b>ë‚´ ë§ˆë‹ˆë˜:</b> ${res.me.target}<br>`;
      res.targetGifts.forEach(g =>
        html += `- ${g.n}<br>`
      );
    } else {
      html += "<hr>ì•„ì§ ë§¤ì¹­ ì „";
    }

    document.getElementById("result").innerHTML = html;
  });
}

/* ===== ADMIN ===== */
function match() {
  post({
    action: "match",
    gameKey: gameKey.value,
    adminPw: adminPw.value
  }).then(res => {
    if (res.error) alert(res.error);
    else alert("ë§¤ì¹­ ì™„ë£Œ!");
  });
}

function resetAll() {
  if (!confirm("ì •ë§ ë¦¬ì…‹í• ê¹Œìš”?")) return;

  post({
    action: "reset",
    gameKey: gameKey.value,
    adminPw: adminPw.value
  }).then(res => {
    if (res.error) alert(res.error);
    else location.reload();
  });
}
</script>
</body>
</html>
