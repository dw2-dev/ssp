<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ğŸ ë§ˆë‹ˆë˜</title>

<style>
:root {
  --main:#ff6b81;
  --sub:#ffd6de;
  --bg:#fff0f5;
  --dark:#444;
}

body {
  background: linear-gradient(135deg, #ffdde1, #ee9ca7);
  font-family: Pretendard, sans-serif;
  margin:0;
  padding:30px;
}

.card {
  max-width:420px;
  margin:auto;
  background:white;
  border-radius:20px;
  padding:25px;
  box-shadow:0 15px 30px rgba(0,0,0,.15);
  position:relative;
}

h2 { text-align:center; color:var(--main); }

input, button {
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:10px;
  border:1px solid #eee;
  font-size:14px;
}

button {
  background:var(--main);
  color:white;
  border:none;
  font-weight:bold;
  cursor:pointer;
}

button:hover { opacity:.9 }

.section { display:none }

.result {
  background:var(--sub);
  padding:15px;
  border-radius:10px;
  margin-top:15px;
  font-size:14px;
}

.admin-btn {
  position:absolute;
  top:15px;
  right:15px;
  background:#636e72;
  width:38px;
  height:38px;
  border-radius:50%;
  font-size:18px;
}

/* ê´€ë¦¬ì íŒì—… */
.modal {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  align-items:center;
  justify-content:center;
}

.modal-box {
  background:white;
  padding:20px;
  border-radius:15px;
  width:300px;
}
</style>
</head>
<body>

<div class="card">
  <button class="admin-btn" onclick="openAdmin()">âš™ï¸</button>

  <h2>ğŸ ë§ˆë‹ˆë˜</h2>

  <!-- GAME KEY -->
  <div id="keySection">
    <input id="gameKey" placeholder="Game Key">
    <button onclick="enter()">ì…ì¥</button>
  </div>

  <!-- REGISTER -->
  <div id="registerSection" class="section">
    <h3>ì°¸ê°€ ë“±ë¡</h3>
    <input id="rName" placeholder="ì´ë¦„">
    <input id="rPw" placeholder="ë¹„ë°€ë²ˆí˜¸">

    <hr>
    <small>5ë§Œì› ì´í•˜ ì„ ë¬¼</small>
    <input id="g1" placeholder="ì„ ë¬¼ 1 ì´ë¦„">
    <input id="g1l" placeholder="ì„ ë¬¼ 1 ë§í¬">
    <input id="g2" placeholder="ì„ ë¬¼ 2 ì´ë¦„">
    <input id="g2l" placeholder="ì„ ë¬¼ 2 ë§í¬">
    <input id="g3" placeholder="ì„ ë¬¼ 3 ì´ë¦„">
    <input id="g3l" placeholder="ì„ ë¬¼ 3 ë§í¬">

    <button onclick="register()">ë“±ë¡</button>
  </div>

  <!-- LOGIN -->
  <div id="loginSection" class="section">
    <h3>ë¡œê·¸ì¸</h3>
    <input id="lName" placeholder="ì´ë¦„">
    <input id="lPw" placeholder="ë¹„ë°€ë²ˆí˜¸">
    <button onclick="login()">ì¡°íšŒ</button>
  </div>

  <div id="result" class="result"></div>
</div>

<!-- ADMIN MODAL -->
<div id="adminModal" class="modal">
  <div class="modal-box">
    <h3>ê´€ë¦¬ì</h3>
    <input id="adminPw" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸">
    <button onclick="match()">ğŸ¯ ë§ˆë‹ˆë˜ ë°°ì •</button>
    <button onclick="resetAll()" style="background:#999">ğŸ”„ ì „ì²´ ë¦¬ì…‹</button>
    <button onclick="closeAdmin()" style="background:#ddd;color:#444">ë‹«ê¸°</button>
  </div>
</div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbyt0B7ndeqVr2RSnVSINO1JIvVfddn7S3VAoMGoJRoHqbT3zWyL_OjrYCSNmaTRexTpag/exec";

/* ê³µí†µ */
const post = d => fetch(GAS_URL,{method:"POST",body:JSON.stringify(d)}).then(r=>r.json());
const show = id => document.getElementById(id).style.display="block";
const hide = id => document.getElementById(id).style.display="none";

/* ë‹¨ê³„ */
function enter(){
  if(!gameKey.value) return alert("GameKey ì…ë ¥");
  hide("keySection");
  show("registerSection");
}

function register(){
  const gifts=[
    {n:g1.value,l:g1l.value},
    {n:g2.value,l:g2l.value},
    {n:g3.value,l:g3l.value}
  ].filter(g=>g.n);

  post({
    action:"register",
    gameKey:gameKey.value,
    name:rName.value,
    pw:rPw.value,
    gifts
  }).then(r=>{
    if(r.error) alert(r.error);
    else{
      alert("ë“±ë¡ ì™„ë£Œ");
      hide("registerSection");
      show("loginSection");
    }
  });
}

function login(){
  post({
    action:"login",
    gameKey:gameKey.value,
    name:lName.value,
    pw:lPw.value
  }).then(r=>{
    if(r.error) return alert(r.error);

    let h="<b>ğŸ ë‚´ê°€ ë°›ê³  ì‹¶ì€ ì„ ë¬¼</b><br>";
    r.me.gifts.forEach(g=>h+=`- <a href="${g.l}" target="_blank">${g.n}</a><br>`);

    if(r.me.target){
      h+=`<hr><b>ë‚´ ë§ˆë‹ˆë˜:</b> ${r.me.target}<br>`;
      r.targetGifts.forEach(g=>h+=`- ${g.n}<br>`);
    }else h+="<hr>ì•„ì§ ë§¤ì¹­ ì „";

    result.innerHTML=h;
  });
}

/* ê´€ë¦¬ì */
function openAdmin(){ show("adminModal"); }
function closeAdmin(){ hide("adminModal"); }

function match(){
  post({
    action:"match",
    gameKey:gameKey.value,
    adminPw:adminPw.value
  }).then(r=>alert(r.error||"ë§¤ì¹­ ì™„ë£Œ!"));
}

function resetAll(){
  if(!confirm("ì „ì²´ ë¦¬ì…‹?")) return;
  post({
    action:"reset",
    gameKey:gameKey.value,
    adminPw:adminPw.value
  }).then(r=>{
    if(r.error) alert(r.error);
    else location.reload();
  });
}
</script>
</body>
</html>
