<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë§ˆë‹ˆë˜ğŸ</title>
<style>
body { font-family: sans-serif; background:#fff0f5; padding:20px }
.card { background:white; padding:20px; border-radius:12px; max-width:420px; margin:auto }
input, button { width:100%; padding:10px; margin-top:8px }
button { background:#ff6b81; color:white; border:none; border-radius:8px }
.result { margin-top:15px; background:#fff5f5; padding:10px }
.admin { background:#636e72 }
</style>
</head>
<body>

<div class="card">
<h2>ğŸë§ˆë‹ˆë˜</h2>

<input id="gameKey" placeholder="ì•”í˜¸ë¥¼ ëŒ€ì‹œì˜¤">

<h3>ì°¸ê°€ ë“±ë¡</h3>
<input id="r-name" placeholder="ì´ë¦„">
<input id="r-pw" placeholder="ë¹„ë°€ë²ˆí˜¸">
    
<hr>
<h3>5ë§Œì› ì´í•˜ì˜ ì„ ë¬¼ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</h3>
    
<input id="g1" placeholder="ì„ ë¬¼1 ì´ë¦„">
<input id="g1l" placeholder="ì„ ë¬¼1 ë§í¬">
<input id="g2" placeholder="ì„ ë¬¼2 ì´ë¦„">
<input id="g2l" placeholder="ì„ ë¬¼2 ë§í¬">
<input id="g3" placeholder="ì„ ë¬¼3 ì´ë¦„">
<input id="g3l" placeholder="ì„ ë¬¼3 ë§í¬">
<button onclick="register()">ë“±ë¡</button>

<hr>

<h3>ë¡œê·¸ì¸</h3>
<input id="l-name" placeholder="ì´ë¦„">
<input id="l-pw" placeholder="ë¹„ë°€ë²ˆí˜¸">
<button onclick="login()">ì¡°íšŒ</button>

<div id="result" class="result"></div>

<hr>

<h3>ê´€ë¦¬ì</h3>
<input id="adminPw" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸">
<button class="admin" onclick="match()">ë§¤ì¹­</button>
<button class="admin" onclick="resetAll()">ë¦¬ì…‹</button>
</div>

<script>
const GAS_URL = "https://script.google.com/macros/s/AKfycbyt0B7ndeqVr2RSnVSINO1JIvVfddn7S3VAoMGoJRoHqbT3zWyL_OjrYCSNmaTRexTpag/exec";

/* ========================= */
function post(data) {
  return fetch(GAS_URL, {
    method: "POST",
    body: JSON.stringify(data)
  }).then(r => r.json());
}

/* ========================= */
function register() {
  const gifts = [
    { n: g1.value, l: g1l.value },
    { n: g2.value, l: g2l.value },
    { n: g3.value, l: g3l.value }
  ].filter(g => g.n);

  post({
    action: "register",
    gameKey: gameKey.value,
    name: r-name.value,
    pw: r-pw.value,
    gifts
  }).then(res => {
    if (res.error) alert("ë“±ë¡ ì‹¤íŒ¨: " + res.error);
    else alert("ë“±ë¡ ì™„ë£Œ!");
  });
}

function login() {
  post({
    action: "login",
    gameKey: gameKey.value,
    name: l-name.value,
    pw: l-pw.value
  }).then(res => {
    if (res.error) return alert("ë¡œê·¸ì¸ ì‹¤íŒ¨");

    let html = "<b>ë‚´ê°€ ë°›ê³  ì‹¶ì€ ì„ ë¬¼</b><br>";
    res.me.gifts.forEach(g =>
      html += `- <a href="${g.l}" target="_blank">${g.n}</a><br>`
    );

    if (res.me.target) {
      html += `<hr><b>ë‚´ ë§ˆë‹ˆë˜:</b> ${res.me.target}<br>`;
      res.targetGifts.forEach(g =>
        html += `- ${g.n}<br>`
      );
    } else {
      html += "<hr>ì•„ì§ ë§¤ì¹­ ì „";
    }

    result.innerHTML = html;
  });
}

function match() {
  post({
    action: "match",
    gameKey: gameKey.value,
    adminPw: adminPw.value
  }).then(res => {
    if (res.error) alert("ì‹¤íŒ¨: " + res.error);
    else alert("ë§¤ì¹­ ì™„ë£Œ!");
  });
}

function resetAll() {
  if (!confirm("ì •ë§ ë¦¬ì…‹í• ê¹Œìš”?")) return;

  post({
    action: "reset",
    gameKey: gameKey.value,
    adminPw: adminPw.value
  }).then(res => {
    if (res.error) alert("ì‹¤íŒ¨: " + res.error);
    else alert("ë¦¬ì…‹ ì™„ë£Œ!");
  });
}
</script>
</body>
</html>
